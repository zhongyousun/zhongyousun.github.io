---
title: "SQL SCOPE_IDENTITY() and @@IDENTITY Differences in Retrieving Auto-Increment Values"
date: 2023-03-20T10:44:19+08:00
draft: false
slug: "tutorials/sql-scopeidentity-identity-diff"
thumbnail: "img/thumbnail/023en.png" # Thumbnail image
description: "Retrieve the Most Recently Added Data in SQL"
categories:
  - "Program"
tags:
  - "SQL"
# Theme-Defined params
lead: "" # Lead text
authorbox: true # Enable authorbox for specific page
pager: false # Enable pager navigation (prev/next) for specific page
toc: true # Enable Table of Contents for specific page
mathjax: true # Enable MathJax for specific page
---
Using SCOPE_IDENTITY() in SQL Server to Retrieve the Most Recently Insert Data and Comparing it with @@IDENTITY for Value Retrieval Differences.     
<!--more-->
{{< br 3  1>}}

### Requirement
In frontend development, it is common to require subsequent processing of newly added data, which often involves the use of the IDENTITY value of the added data. Similarly, in backend databases, triggers may be used to modify or add data, and the IDENTITY value of the newly added data may also be required for subsequent processing. This article will discuss the practical differences between SCOPE_IDENTITY() and @@IDENTITY in SQL Server.
{{< br 3  2>}}

### Principle
`SCOPE_IDENTITY()` function returns the most recently inserted identity value within the current scope. This means that it only returns the identity value generated by the insert statement currently being executed, and is not affected by any identity values generated by any triggers.  

`@@IDENTITY` function returns the last identity value generated by an insert statement, regardless of the scope in which it was generated. Therefore, if the insert statement includes triggers, the @@IDENTITY function may return an unexpected identity value.  

It may sound a bit complicated, so let's provide an example to illustrate the differences between the two functions.    
{{< br 3  3>}}

### Example

1.Create an example table
```SQL {linenos=inline}
CREATE TABLE ExampleTable (
  ID INT PRIMARY KEY IDENTITY(1,1),
  Name NVARCHAR(50) NOT NULL
);
```

2.Create an trigger if there is a newly data inserted that copy the newly data to another row in the same table.
```SQL {linenos=inline}
CREATE TRIGGER ExampleTrigger
ON ExampleTable
FOR INSERT
AS
BEGIN
  INSERT INTO ExampleTable (Name)
  SELECT Name FROM INSERTED
END;
```
3.Insert a row with Name "Alvin" to the table, which will activate the trigger and create another row with the same data. As a result, the table will have two rows with Name "Alvin".  
```SQL {linenos=inline}
INSERT INTO ExampleTable (Name)
VALUES ('Alvin');

SELECT SCOPE_IDENTITY()
SELECT @@IDENTITY

DROP TABLE ExampleTable;
```
The content of the table is as follows:  
|  ID   | Name  |
|  ----  | ----  |
| 1  | Alvin |
| 2  | Alvin |

The result of `SELECT SCOPE_IDENTITY()` is 1.  
The result of `SELECT @@IDENTITY` is 2.   


It is clear that SCOPE_IDENTITY() retrieves the ID of the current insert, while @@IDENTITY retrieves the ID of the data inserted by the trigger.  
{{< br 3  4>}}

### Conclusion
When retrieving the value of an auto-incremented field for subsequent processing of the newly inserted data, it is recommended to use SCOPE_IDENTITY() rather than @@IDENTITY. Using @@IDENTITY may result in obtaining an additional value that was inserted due to the current insertion, whereas SCOPE_IDENTITY() specifically retrieves the ID of the newly inserted data.





